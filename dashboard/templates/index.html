<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Change Analyzer Dashboard</title>

    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Price Change Analyzer Dashboard</h1>
            <div class="header-controls">
                <select id="file-selector" class="file-selector">
                    <option value="">Loading files...</option>
                </select>
                <button id="refresh-btn" class="btn btn-secondary">Refresh</button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel: Chart and Stats -->
            <div class="chart-panel">
                <!-- Stats Summary -->
                <div id="stats-summary" class="stats-summary">
                    <div class="stat-item">
                        <span class="stat-label">Rank:</span>
                        <span id="stat-rank" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Change:</span>
                        <span id="stat-change" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Time:</span>
                        <span id="stat-time" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Price:</span>
                        <span id="stat-price" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Events:</span>
                        <span id="stat-events" class="stat-value">-</span>
                    </div>
                </div>

                <!-- Interval Selector (if multiple intervals in file) -->
                <div id="interval-selector-container" class="interval-selector-container" style="display: none;">
                    <label for="interval-selector">Select Interval:</label>
                    <select id="interval-selector" class="interval-selector">
                        <option value="">Select an interval...</option>
                    </select>
                </div>

                <!-- Chart Container -->
                <div id="chart-container" class="chart-container">
                    <div id="loading" class="loading">
                        <div class="spinner"></div>
                        <p>Loading chart data...</p>
                    </div>
                </div>

                <!-- Chart Legend -->
                <div class="chart-legend">
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #2962ff;"></span>
                        <span>Price</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #00ff88;"></span>
                        <span>Bid Events</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #ff4444;"></span>
                        <span>Ask Events</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker" style="background: #ffaa00;"></span>
                        <span>Market Trades</span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Whale Events -->
            <div class="events-panel">
                <div class="events-header">
                    <h2>Whale Events</h2>
                    <div class="events-filters">
                        <input type="text" id="event-search" placeholder="Search events..." class="search-input">
                        <select id="event-type-filter" class="filter-select">
                            <option value="">All Types</option>
                            <option value="new_bid">New Bid</option>
                            <option value="new_ask">New Ask</option>
                            <option value="increase">Volume Increase</option>
                            <option value="decrease">Volume Decrease</option>
                            <option value="market_buy">Market Buy</option>
                            <option value="market_sell">Market Sell</option>
                            <option value="entered_top">Entered Top</option>
                            <option value="left_top">Left Top</option>
                        </select>
                    </div>
                </div>

                <!-- Event Statistics -->
                <div id="event-stats" class="event-stats">
                    <div class="event-stat">
                        <span class="event-stat-label">Total Events:</span>
                        <span id="event-stat-total" class="event-stat-value">0</span>
                    </div>
                    <div class="event-stat">
                        <span class="event-stat-label">Total Volume:</span>
                        <span id="event-stat-volume" class="event-stat-value">$0</span>
                    </div>
                </div>

                <!-- Events Timeline -->
                <div class="events-timeline">
                    <!-- Before Events -->
                    <div id="events-before" class="events-section" style="display: none;">
                        <h3 class="section-title">Before Interval</h3>
                        <div id="events-before-list" class="events-list"></div>
                    </div>

                    <!-- During Events (Main) -->
                    <div id="events-during" class="events-section">
                        <h3 class="section-title">During Interval</h3>
                        <div id="events-during-list" class="events-list"></div>
                    </div>

                    <!-- After Events -->
                    <div id="events-after" class="events-section" style="display: none;">
                        <h3 class="section-title">After Interval</h3>
                        <div id="events-after-list" class="events-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Price Change Analyzer Dashboard | Powered by <a href="https://www.tradingview.com" target="_blank">TradingView Lightweight Charts</a></p>
        </footer>
    </div>

    <!-- Error Toast -->
    <div id="error-toast" class="error-toast" style="display: none;">
        <span id="error-message"></span>
        <button onclick="this.parentElement.style.display='none'">&times;</button>
    </div>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
</body>
</html>
