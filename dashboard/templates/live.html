<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Order Book Dashboard</title>

    <!-- Apache ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/live.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üìä Live Order Book Dashboard</h1>
            <div class="header-controls">
                <select id="symbol-selector" class="symbol-selector">
                    <option value="SPX_USDT">SPX_USDT</option>
                    <option value="BANANA_USDT">BANANA_USDT</option>
                    <option value="BTC_USDT">BTC_USDT</option>
                    <option value="ETH_USDT">ETH_USDT</option>
                    <option value="WIF_USDT">WIF_USDT</option>
                </select>
                <select id="lookback-selector" class="lookback-selector">
                    <option value="5m">5 minutes</option>
                    <option value="15m">15 minutes</option>
                    <option value="30m" selected>30 minutes</option>
                    <option value="1h">1 hour</option>
                    <option value="3h">3 hours</option>
                    <option value="6h">6 hours</option>
                </select>
                <button id="refresh-toggle" class="btn btn-primary">
                    <span id="refresh-icon">‚è∏</span> Auto-refresh
                </button>
                <button id="refresh-now" class="btn btn-secondary">üîÑ Refresh Now</button>
                <a href="/" class="btn btn-link">‚Üê Price Analysis</a>
                <a href="/whale-monitor" class="btn btn-link">üêã Whale Monitor</a>
            </div>
        </header>

        <!-- Stats Summary -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-label">Current Price</div>
                <div id="stat-price" class="stat-value">-</div>
                <div id="stat-price-change" class="stat-subvalue">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Spread</div>
                <div id="stat-spread" class="stat-value">-</div>
                <div class="stat-subvalue">Bid/Ask</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Whale Events</div>
                <div id="stat-events" class="stat-value">-</div>
                <div id="stat-events-breakdown" class="stat-subvalue">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Volume</div>
                <div id="stat-volume" class="stat-value">-</div>
                <div class="stat-subvalue">Last hour</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Status</div>
                <div id="stat-status" class="stat-value status-live">‚óè</div>
                <div id="stat-last-update" class="stat-subvalue">-</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel: Price Chart -->
            <div class="chart-panel">
                <div class="panel-header">
                    <h2>Price Chart</h2>
                    <div class="chart-controls">
                        <button id="chart-fullscreen" class="btn-icon" title="Fullscreen">‚õ∂</button>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <div id="price-chart" class="chart-container">
                        <div id="chart-loading" class="loading">
                            <div class="spinner"></div>
                            <p>Loading chart...</p>
                        </div>
                    </div>
                </div>
                <!-- Chart Legend -->
                <div class="chart-legend">
                    <div class="legend-title">Whale Event Markers</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #00c2ff;">‚óè</span>
                            <span class="legend-label">Market Buy</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #ff00ff;">‚óè</span>
                            <span class="legend-label">Market Sell</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #00ff88;">‚ñ≤</span>
                            <span class="legend-label">New Bid</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #ff4444;">‚ñº</span>
                            <span class="legend-label">New Ask</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-marker" style="background: #88cc88;">‚óÜ</span>
                            <span class="legend-label">Volume Change</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Whale Events Feed -->
            <div class="events-panel">
                <div class="panel-header">
                    <h2>Whale Events Feed</h2>
                    <div class="event-filters">
                        <input type="number" id="min-usd-filter" placeholder="Min USD" value="5000" step="1000">
                        <select id="event-type-filter" class="filter-select">
                            <option value="">All Types</option>
                            <option value="market_buy">Market Buy</option>
                            <option value="market_sell">Market Sell</option>
                            <option value="increase">Increase</option>
                            <option value="decrease">Decrease</option>
                            <option value="new_bid">New Bid</option>
                            <option value="new_ask">New Ask</option>
                        </select>
                    </div>
                </div>
                <div id="events-feed" class="events-feed">
                    <div class="loading-placeholder">
                        <div class="spinner"></div>
                        <p>Loading whale events...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Book Visualization (Bottom) -->
        <div class="orderbook-panel">
            <div class="panel-header">
                <h2>Order Book Snapshot</h2>
                <div id="orderbook-time" class="orderbook-time">-</div>
            </div>
            <div class="orderbook-container">
                <div class="orderbook-side bids-side">
                    <div class="orderbook-header">
                        <h3>Bids (Buy Orders)</h3>
                        <div id="bid-total" class="side-total">$0</div>
                    </div>
                    <div id="bids-list" class="orderbook-list">
                        <div class="loading-placeholder">Loading bids...</div>
                    </div>
                </div>
                <div class="orderbook-spread">
                    <div class="spread-label">Spread</div>
                    <div id="spread-value" class="spread-value">-</div>
                    <div class="spread-visual">
                        <div class="bid-line"></div>
                        <div class="ask-line"></div>
                    </div>
                </div>
                <div class="orderbook-side asks-side">
                    <div class="orderbook-header">
                        <h3>Asks (Sell Orders)</h3>
                        <div id="ask-total" class="side-total">$0</div>
                    </div>
                    <div id="asks-list" class="orderbook-list">
                        <div class="loading-placeholder">Loading asks...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Live Order Book Dashboard | Real-time data from InfluxDB | Updates every 5 seconds</p>
        </footer>
    </div>

    <!-- Event Details Modal -->
    <div id="event-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Whale Event Details</h3>
                <button class="modal-close" onclick="document.getElementById('event-modal').style.display='none'">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/live.js') }}"></script>
</body>
</html>
